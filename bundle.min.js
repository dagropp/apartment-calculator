const _toNode=e=>"string"==typeof e?document.createTextNode(e):e,_setAttributes=(e,t)=>{Object.entries(t).forEach(([t,a])=>t in e?e[t]=a:e.setAttribute(t,a))},_setStyle=(e,t)=>{Object.entries(t).forEach(([t,a])=>t in e.style?e.style[t]=a:e.style.setProperty(t,a))},_parseStateValue=(e,t)=>"function"==typeof e?e(t):e,createElement=(e,t,...a)=>{const n=document.createElement(e),{pointer:r,style:o,...c}=t||{};return r&&(r.element=n),o&&_setStyle(n,o),c&&_setAttributes(n,c),n.append(...a.filter(Boolean)),n},createState=(e,t={})=>{const a=(e,t)=>Object.entries(e).forEach(([e,a])=>{o[e]=_toNode(a(t,n))}),n=async e=>{const a=_parseStateValue(e,r);return Object.entries(t).forEach(([e,t])=>{const r=_toNode(t(a,n));o[e].replaceWith(r),o[e]=r}),r=a,a};let r=e;const o={};return a(t,r),[o,n,{getState:()=>r,resetState:()=>n(e),setCreator(e){Object.entries(e).forEach(([e,a])=>t[e]=a),a(e,r)}}]},initDoDom=(e,...t)=>{const a=document.getElementById(e);a&&a.replaceWith(...t)},_calculateTax=e=>{const t=e-1805545;return Math.ceil(t<=0?0:t<=336060?.035*t:11762.1+.05*(t-336060))},buildCostObject=(e,t)=>{const a=Math.ceil(.02*e*1.17),n=Math.ceil(e*(.01/3)*1.17),r=_calculateTax(e),o=a+n+r;return{id:btoa(encodeURI(t)),name:t,initial:{title:"עלות ראשונית",value:e},realtor:{title:"דמי תיווך",breakdown:'2% + מע"מ',value:a},attorney:{title:'עו"ד',breakdown:'0.33% + מע"מ',value:n},tax:{title:"מס רכישה",breakdown:"לפי מדרגות מס",value:r},extras:{title:'סה"כ תוספות',value:o},total:{title:'סה"כ',value:o+e}}},SAVED_APARTMENTS="saved_apartments",getSavedApartments=()=>{const e=localStorage.getItem(SAVED_APARTMENTS);return e?JSON.parse(e):setSavedApartments([])},setSavedApartments=e=>(localStorage.setItem(SAVED_APARTMENTS,JSON.stringify(e)),e),addSavedApartment=e=>{const t=getSavedApartments(),a=t.findIndex(({id:t})=>t===e.id);return-1!==a?t[a]=e:t.unshift(e),setSavedApartments(t)},removeApartment=e=>{const t=getSavedApartments(),a=t.findIndex(t=>t.id===e);return-1!==a&&t.splice(a,1),setSavedApartments(t)},stringToNumber=e=>Number(e.replaceAll(",","")),numberDisplay=e=>{const t=stringToNumber(e);return""===e||isNaN(t)?e:t.toLocaleString()},verifyNumber=e=>isNaN(e)?0:e,[Outcome,setOutcome,OutcomeMethods]=createState(null,{table:e=>e?OutcomeTable({data:e}):""}),InputContainer=({input:e,icon:t})=>createElement("div",{className:"input-wrapper"},t?createElement("i",{className:`fa fa-${t}`}):"",e),OutcomeTableRow=({breakdown:e="",title:t="",value:a})=>{const n="number"==typeof a?"₪"+a.toLocaleString():a;return createElement("tr",null,createElement("td",{className:"title"},t),createElement("td",{className:"value"},n),createElement("td",{className:"breakdown"},e))},RemoveApartmentButton=({id:e})=>{return createElement("a",{className:"remove-apartment","aria-role":"button",onclick:()=>{removeApartment(e),setOutcome(null)}},createElement("i",{className:"fa fa-trash"}),"הסרת דירה")},OutcomeTable=({data:e})=>{const{name:t,id:a,...n}=e;return createElement("div",{className:"outcome-container"},createElement("table",null,OutcomeTableRow({value:"עלות",breakdown:"פירוט"}),...Object.values(n).map(OutcomeTableRow)),RemoveApartmentButton({id:e.id}))};OutcomeMethods.setCreator({select:e=>{const t=getSavedApartments();t.sort((e,t)=>e.name.localeCompare(t.name));const a=e?t.findIndex(({name:t})=>t===e.name):"";if(t.length){const e=t.map(({name:e,id:t},n)=>createElement("option",{value:t,selected:n===a},e));return createElement("optgroup",{label:"דירות שמורות"},...e)}return""}});const ApartmentSelect=()=>{const e=createElement("select",{onchange:e=>{const t=e.target,a=getSavedApartments(),n=a.findIndex(e=>e.id===t.value);if(-1!==n){const e=a[n];setOutcome(e)}else setOutcome(null)}},createElement("option",{value:""},"דירה חדשה"),Outcome.select);return InputContainer({input:e,icon:""})},handleInput=e=>{const t=e.target;t.value=numberDisplay(t.value)};OutcomeMethods.setCreator({nameInput:e=>InputContainer({input:createElement("input",{name:"name",placeholder:"שם הדירה",required:!0,autocomplete:"off",type:e?"hidden":"text",value:e?e.name:""}),icon:e?"":"pen"}),costInput:e=>InputContainer({input:createElement("input",{name:"cost",inputMode:"numeric",required:!0,autocomplete:"off",placeholder:"עלות",oninput:handleInput,value:e?e.initial.value.toLocaleString():""}),icon:"shekel-sign"}),button:e=>createElement("button",{type:"submit"},e?"חישוב חדש":"חישוב")});const MainForm=()=>{return createElement("form",{onsubmit:e=>{e.preventDefault();const t=e.target,{cost:a,name:n}=Object.fromEntries(new FormData(t)),r=buildCostObject(verifyNumber(stringToNumber(a)),n);addSavedApartment(r),setOutcome(r)}},Outcome.nameInput,Outcome.costInput,Outcome.button)},App=()=>createElement("div",{className:"main-app"},createElement("h1",null,"המֵחַשְׁבוֹן",createElement("i",{className:"fa fa-calculator"})),ApartmentSelect(),createElement("form",{onsubmit:e=>{e.preventDefault();const t=e.target,{cost:a,name:n}=Object.fromEntries(new FormData(t)),r=buildCostObject(verifyNumber(stringToNumber(a)),n);addSavedApartment(r),setOutcome(r)}},Outcome.nameInput,Outcome.costInput,Outcome.button),Outcome.table);window.addEventListener("DOMContentLoaded",()=>{initDoDom("root",App())});